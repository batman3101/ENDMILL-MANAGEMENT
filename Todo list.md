# 프로젝트 동적 연동 개선 Todo List

**프로젝트 시작일:** 2025-10-10
**예상 완료일:** 2025-11-21 (6주)
**현재 Phase:** Phase 1

---

## 📊 전체 진행 상황

- **Phase 1 (고우선순위):** 0/5 완료 (0%)
- **Phase 2 (중우선순위):** 0/5 완료 (0%)
- **Phase 3 (필수):** 0/4 완료 (0%)
- **Phase 4 (개선):** 0/4 완료 (0%)
- **전체:** 0/18 완료 (0%)

---

## 🎯 Phase 1: 핵심 연결 (Week 1-2)

**목표:** 앤드밀 상세 페이지에서 실제 사용 설비 확인 가능

**기간:** 2025-10-10 ~ 2025-10-23 (2주)

### 작업 목록

- [ ] **1.1 데이터 검증**
  - [ ] tool_positions 테이블 데이터 정합성 확인
  - [ ] 모든 설비의 tool_positions 데이터 입력 여부 확인
  - [ ] equipment 테이블의 current_model, process 정확성 검증
  - [ ] 테스트용 샘플 데이터 준비 (최소 5개 설비)

- [ ] **1.2 타입 정의 추가**
  - [ ] `lib/types/endmill.ts` 파일 열기
  - [ ] `EndmillCurrentUsage` 인터페이스 추가
  - [ ] `EndmillDetailInfo` 인터페이스에 `currentUsage` 필드 추가
  - [ ] 타입 컴파일 오류 확인

- [ ] **1.3 API 수정 - /api/endmill**
  - [ ] `app/api/endmill/route.ts` 파일 열기
  - [ ] Supabase 쿼리에 `tool_positions` 조인 추가
  - [ ] `tool_positions`에서 `equipment` 정보 JOIN 추가
  - [ ] `processEndmill` 함수에 `currentUsage` 데이터 가공 로직 추가
  - [ ] CAM Sheet 사양과 실제 사용 현황 매칭 로직 구현
  - [ ] API 응답 테스트 (Postman 또는 브라우저)

- [ ] **1.4 앤드밀 상세 페이지 UI 수정**
  - [ ] `app/dashboard/endmill-detail/[code]/page.tsx` 파일 열기
  - [ ] API 호출 로직 수정 (currentUsage 포함)
  - [ ] "실시간 사용 현황" 섹션 UI 추가
    - [ ] 테이블 헤더 구현
    - [ ] 데이터 로우 렌더링
    - [ ] 사용률 프로그레스 바 구현
    - [ ] 색상 코딩 (80% 이상 빨강, 50% 이상 노랑, 그 이하 초록)
  - [ ] "등록된 CAM Sheet 사양" 섹션 유지
  - [ ] 로딩 상태 처리
  - [ ] 빈 데이터 상태 처리 (사용중인 설비 없음)

- [ ] **1.5 테스트 및 검증**
  - [ ] 앤드밀 코드 입력 후 실시간 사용 현황 표시 확인
  - [ ] 여러 앤드밀 코드로 테스트 (최소 3개)
  - [ ] 설비별 데이터 정확성 검증
  - [ ] CAM Sheet 사양과 실제 total_life 일치 여부 확인
  - [ ] 사용률 계산 정확성 확인
  - [ ] UI 반응성 테스트 (모바일/태블릿)

### Phase 1 완료 조건
- [x] 앤드밀 상세 페이지에 실시간 사용 현황이 표시됨
- [x] 설비번호, 모델, 공정, T번호, 수명, 사용률이 정확하게 표시됨
- [x] CAM Sheet 사양 정보와 실시간 정보가 모두 표시됨
- [x] 최소 3개 앤드밀에 대해 정상 동작 확인

---

## 🔄 Phase 2: 양방향 연결 (Week 3-4)

**목표:** 설비 ↔ 앤드밀 양방향 확인 가능

**기간:** 2025-10-24 ~ 2025-11-06 (2주)

### 작업 목록

- [ ] **2.1 API 수정 - /api/equipment**
  - [ ] `app/api/equipment/route.ts` 파일 열기
  - [ ] 설비 조회 쿼리에 `tool_positions` 조인 추가
  - [ ] `tool_positions`에서 `endmill_types` 정보 JOIN 추가
  - [ ] 응답 데이터에 장착된 앤드밀 목록 포함
  - [ ] API 응답 테스트

- [ ] **2.2 설비 상세 페이지 수정**
  - [ ] `app/dashboard/equipment/[id]/page.tsx` 파일 수정 (또는 생성)
  - [ ] API 호출 로직 수정
  - [ ] "장착된 앤드밀" 섹션 UI 추가
    - [ ] T01~T24 포지션별 표시
    - [ ] 앤드밀 코드, 카테고리, 수명 표시
    - [ ] 사용률 프로그레스 바
  - [ ] 빈 포지션 표시 처리

- [ ] **2.3 설비 배정 변경 API 생성**
  - [ ] `app/api/equipment/[id]/assign/route.ts` 파일 생성
  - [ ] PUT 메서드 구현
  - [ ] equipment 테이블 업데이트 로직
  - [ ] tool_positions의 total_life 자동 업데이트 로직
  - [ ] 새 모델/공정에 맞는 CAM Sheet 사양 조회
  - [ ] API 테스트

- [ ] **2.4 설비 배정 변경 UI 구현**
  - [ ] 설비 관리 페이지에 "모델/공정 변경" 버튼 추가
  - [ ] 모달 또는 폼 UI 구현
  - [ ] API 호출 및 결과 처리
  - [ ] 성공/실패 알림 표시

- [ ] **2.5 테스트 및 검증**
  - [ ] 설비 페이지에서 장착된 앤드밀 목록 확인
  - [ ] 설비 배정 변경 후 앤드밀 상세 페이지 자동 반영 확인
  - [ ] tool_positions의 total_life 자동 업데이트 확인
  - [ ] 양방향 데이터 일관성 검증

### Phase 2 완료 조건
- [x] 설비 상세 페이지에서 장착된 앤드밀 목록 확인 가능
- [x] 설비 배정 변경 시 CAM Sheet 사양 자동 적용
- [x] 설비 변경이 앤드밀 상세 페이지에 실시간 반영
- [x] 앤드밀 ↔ 설비 양방향 조회 가능

---

## 🔗 Phase 3: 데이터 동기화 (Week 5)

**목표:** 모든 변경사항이 실시간 반영

**기간:** 2025-11-07 ~ 2025-11-13 (1주)

### 작업 목록

- [ ] **3.1 공구 교체 API 수정**
  - [ ] `app/api/tool-changes/route.ts` 파일 열기
  - [ ] tool_changes 테이블 기록 로직 확인 (기존)
  - [ ] tool_positions 업데이트 로직 추가
    - [ ] endmill_type_id 업데이트
    - [ ] current_life 0으로 초기화
    - [ ] total_life를 CAM Sheet 사양으로 설정
    - [ ] install_date 업데이트
    - [ ] status 'active'로 설정
  - [ ] 재고 감소 로직 확인 (기존)
  - [ ] API 테스트

- [ ] **3.2 공구 교체 UI 확인 및 수정**
  - [ ] `app/dashboard/tool-changes/page.tsx` 확인
  - [ ] 공구 교체 폼 확인
  - [ ] API 호출 후 tool_positions 업데이트 확인
  - [ ] 필요시 UI 수정

- [ ] **3.3 실시간 동기화 테스트**
  - [ ] 공구 교체 후 앤드밀 상세 페이지 자동 반영 확인
  - [ ] 공구 교체 후 설비 상세 페이지 자동 반영 확인
  - [ ] 재고 변동 확인
  - [ ] tool_changes 기록 확인

- [ ] **3.4 데이터 정합성 검증**
  - [ ] tool_positions와 tool_changes 데이터 일치 여부 확인
  - [ ] equipment와 tool_positions 관계 검증
  - [ ] cam_sheet_endmills와 tool_positions total_life 일치 확인
  - [ ] 데이터 정합성 검증 스크립트 작성 (선택사항)

### Phase 3 완료 조건
- [x] 공구 교체 시 tool_positions가 자동 업데이트됨
- [x] 앤드밀 상세 페이지에서 교체 결과 즉시 확인 가능
- [x] 설비 상세 페이지에서 교체 결과 즉시 확인 가능
- [x] 모든 테이블 데이터 일관성 유지

---

## 📈 Phase 4: 대시보드 & 리포트 (Week 6)

**목표:** 모든 페이지 데이터 일관성 확보

**기간:** 2025-11-14 ~ 2025-11-21 (1주)

### 작업 목록

- [ ] **4.1 대시보드 수정**
  - [ ] `app/dashboard/page.tsx` 파일 열기
  - [ ] 실시간 사용 현황 데이터 조회 로직 추가
  - [ ] 앤드밀별 사용 설비 개수 표시
  - [ ] 모델별 앤드밀 사용 현황 차트 추가
  - [ ] 설비별 수명 소진율 통계 추가

- [ ] **4.2 리포트 수정**
  - [ ] `app/dashboard/reports/page.tsx` 확인
  - [ ] 설비별 앤드밀 사용 이력 리포트 추가
  - [ ] 모델/공정별 앤드밀 교체 빈도 분석
  - [ ] CAM Sheet 사양 vs 실제 사용 수명 비교 리포트

- [ ] **4.3 성능 최적화**
  - [ ] 800대 설비 데이터 로딩 성능 테스트
  - [ ] 필요시 페이지네이션 추가
  - [ ] 쿼리 최적화 (인덱스 확인)
  - [ ] 캐싱 전략 검토 및 적용

- [ ] **4.4 전체 통합 테스트**
  - [ ] 앤드밀 관리 → 설비 조회 → 공구 교체 → 대시보드 전체 흐름 테스트
  - [ ] 설비 배정 변경 → 앤드밀 확인 전체 흐름 테스트
  - [ ] CAM Sheet 추가 → 설비 반영 전체 흐름 테스트
  - [ ] 동시성 테스트 (여러 사용자 동시 작업)
  - [ ] 데이터 정합성 최종 검증

### Phase 4 완료 조건
- [x] 대시보드에 실시간 데이터가 반영됨
- [x] 리포트에서 설비별 앤드밀 사용 이력 확인 가능
- [x] 800대 설비 환경에서 성능 문제 없음
- [x] 모든 페이지에서 데이터 일관성 유지

---

## 🔍 최종 검증 체크리스트

### 데이터베이스
- [ ] tool_positions에 모든 설비의 실제 장착 정보 입력됨
- [ ] equipment의 current_model, process 정확성 확인됨
- [ ] cam_sheet_endmills에 모든 모델/공정 조합 등록됨
- [ ] 데이터 정합성 검증 쿼리 실행 완료

### API
- [ ] `/api/endmill` - tool_positions 조회 기능 추가 완료
- [ ] `/api/equipment` - tool_positions 조회 기능 추가 완료
- [ ] `/api/tool-changes` - tool_positions 업데이트 기능 추가 완료
- [ ] `/api/equipment/[id]/assign` - 설비 배정 변경 API 생성 완료
- [ ] 모든 API 응답 타입 정의 업데이트 완료

### 프론트엔드
- [ ] 앤드밀 상세 페이지 - 실시간 사용 현황 섹션 추가 완료
- [ ] 설비 상세 페이지 - 장착된 앤드밀 목록 표시 완료
- [ ] 공구 교체 페이지 - tool_positions 동기화 완료
- [ ] 대시보드 - 실시간 데이터 반영 완료
- [ ] 로딩 상태 및 에러 처리 완료

### 테스트
- [ ] 설비 배정 변경 → 앤드밀 페이지 자동 반영 확인
- [ ] 공구 교체 → 양쪽 페이지 동기화 확인
- [ ] CAM Sheet 추가 → 사양 정보 표시 확인
- [ ] 성능 테스트 (800대 설비 대응) 완료
- [ ] 동시성 테스트 (여러 사용자 동시 수정) 완료

### 문서화
- [ ] API 문서 업데이트 완료
- [ ] 데이터 흐름도 작성 완료
- [ ] 사용자 가이드 업데이트 완료
- [ ] 개발자 가이드 업데이트 완료

---

## 📝 작업 기록

### 2025-10-10
- [ ] 프로젝트 동적 연동 개선 계획 수립
- [ ] Todo list.md 파일 생성
- [ ] Phase 1 착수 준비

### 작업 로그 템플릿
```
### YYYY-MM-DD
- [x] 완료된 작업 항목
- [ ] 진행 중인 작업
- 🐛 발견된 이슈:
- 💡 개선 아이디어:
- ⏰ 다음 작업:
```

---

## 🚨 블로커 및 이슈

### 현재 블로커
_없음_

### 해결된 이슈
_없음_

### 보류된 작업
_없음_

---

## 📌 다음 할 일

**현재 우선순위:**
1. Phase 1 작업 시작
2. tool_positions 데이터 정합성 확인
3. 타입 정의 추가

**진행 가이드:**
1. 위 체크박스를 순서대로 체크하며 진행
2. 각 Phase 완료 시 완료 조건 확인
3. 블로커 발생 시 "블로커 및 이슈" 섹션에 기록
4. 매일 작업 로그 업데이트

---

**마지막 업데이트:** 2025-10-10
**현재 진행률:** 0% (0/18)
**예상 완료일:** 2025-11-21
